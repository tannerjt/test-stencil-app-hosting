import{a as e,c as t,f as r,h as n,g as a,b as o,e as i,i as s,j as c}from"./p-78e655d3.js";import{g as u,r as l,c as p}from"./p-18586bed.js";import{g as d,a as m,b,c as f}from"./p-b7cd5e4e.js";function y(e,t,r){const n=Object.assign(Object.assign({params:{}},r),e);return n.params=t.reduce(((t,r)=>((e[r]||"boolean"==typeof e[r]||"number"==typeof e[r]&&0===e[r])&&(t[r]=e[r]),t)),n.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce(((e,t)=>(n[t]&&(e[t]=n[t]),e)),{})}function g(e,t){return-1!==e.indexOf(t)}class h extends Error{constructor(t,r,n){r=r||"UNKNOWN_ERROR",n=e(n,"rootCause",n),super(r),this.operation=t,this.name="OperationError",this.rootCause=n,Object.setPrototypeOf(this,h.prototype),this.stack=e(n,"stack",(new Error).stack)}}function v(e){const{host:t,path:r,query:n}=e,a=t.endsWith("/")?t:`${t}/`,o=new URL(r,a);return o.search=function(e={}){const t=Object.keys(e).filter((t=>void 0!==e[t])).reduce(((t,r)=>(t[r]=e[r],t)),{});return new URLSearchParams(t).toString()}(n),o.toString()}function C(e){return function(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}(e).then((t=>{const r=e.folderId?`${u(e)}/content/users/${t}/${e.folderId}/items/${e.item.id}/update`:`${u(e)}/content/users/${t}/items/${e.item.id}/update`;var n;return e.params=Object.assign(Object.assign({},e.params),e.item),e.params.extent&&(n=e.params.extent,Array.isArray(n)&&Array.isArray(n[0])&&Array.isArray(n[1]))&&(e.params.extent=function(e){return e.join(",")}(e.params.extent)),l(r,e)}))}function O(e,t){const r=`${u(t)}/community/groups/${e}`,n=Object.assign({httpMethod:"GET"},t);return l(r,n)}function w(e){const t=`${u(e)}/community/groups/${e.group.id}/update`;return e.params=Object.assign(Object.assign({},e.params),e.group),l(t,e)}function S(e){if("string"==typeof e)return e.replace(/\/sharing\/rest\/?$/,"");if("object"==typeof e){const t=e.portalSelf||e,{portalHostname:r,urlKey:n,customBaseUrl:a}=t;if(r||n&&a)return t.isPortal?`https://${t.portalHostname}`:`https://${t.urlKey}.${t.customBaseUrl}`}return S(u(e))}function D(e){return`${S(e)}/sharing/rest`}const j=(e,t,r)=>{const{id:n,access:a}=e,o=`${D(t)}/content/items/${n}`,i=new URLSearchParams({f:"json"});return"public"!==a&&r&&i.append("token",r),`${o}?${i.toString()}`};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function k(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}const A=/\/(map|feature)server/i;function P(e){return e&&e.hubApiUrl||function(e){let t;return e.match(/(qaext|\.mapsqa)\.arcgis.com/)?t="https://hubqa.arcgis.com":e.match(/(devext|\.mapsdevext)\.arcgis.com/)?t="https://hubdev.arcgis.com":e.match(/(www|\.maps)\.arcgis.com/)&&(t="https://hub.arcgis.com"),t}(D(e))}const N={app:["Application","City Engine Web Scene","CityEngine Web Scene","Dashboard","Insights Page","Insights Workbook","Operation View","Web Mapping Application","StoryMap","Web Experience","Urban Model"],dataset:["CSV Collection","CSV","Feature Collection Template","Feature Collection","Feature Layer","Feature Service","File Geodatabase","GeoJSON","GeoJson","KML Collection","KML","Microsoft Excel","Raster Layer","Shapefile","Stream Service","Table"],document:["CAD Drawing","Document Link","Hub Page","Site Page","Image","iWork Keynote","iWork Numbers","iWork Pages","Microsoft Powerpoint","Microsoft Visio","Microsoft Word","Notebook","PDF","Pro Map","Report Template"],event:["Hub Event"],feedback:["Form","Quick Capture Project"],initiative:["Hub Initiative"],template:["Hub Initiative Template"],solution:["Solution"],map:["Image Collection","Image Service","Map Service Layer","Map Service","Scene Service","Scene Layer","Vector Tile Service","Web Map Service","Web Map Tile Service","Web Map","Web Scene","WFS","WMS","WMTS"],other:["360 VR Experience","AppBuilder Widget Package","Application Configuration","ArcPad Package","Code Attachment","Code Sample","Desktop Add In","Desktop Application Template","Desktop Application","Desktop Style","Explorer Add In","Explorer Layer","Geocoding Service","Geometry Service","Geoprocessing Package","Geoprocessing Sample","Geoprocessing Service","Layer File","Layer Package","Layer Template","Layer","Layout","Locator Package","Map Area","Map Document","Map Package","Map Service Definition","Map Template","Mobile Application","Mobile Map Package","Native Application","Network Analysis Service","Operations Dashboard Add In","Project Package","Project Template","Raster Function Template","Rule Package","Scene Package","Service Definition","SQLite Geodatabase","Style","Tile Package","Vector Tile Package","Workflow Manager Package"],site:["Hub Site Application","Site Application"]},{app:I,feedback:$}=N,M=["360 VR Experience","Application","CityEngine Web Scene","Code Sample","CSV Collection","CSV","CAD Drawing","Desktop Application","Desktop Application Template","Desktop Style","File Geodatabase","GeoJson","Geoprocessing Package","Geoprocessing Sample","Image","iWork Keynote","iWork Numbers","KML Collection","KML","Layer","Layer File","Layer Package","Layout","Locator Package","Map Package","Map Service Definition","Map Template","Microsoft Excel","Microsoft Powerpoint","Microsoft Visio","Microsoft Word","Notebook","Operations Dashboard Add In","PDF","Pro Map","Project Package","Project Template","Raster function template","Rule Package","Service Definition","Shapefile","Vector Tile Package","Workflow Manager Package"],B=["Data"];I.concat($);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var T,E=function(){return(E=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},F=new RegExp(/.+(?:map|feature|image)server/i);function x(e){var t=e.match(F);return t?t[0]:function(e){var t=e.split("?")[0];return p(t)}(e)}!function(e){e.CitationContact="metadata.resource.citation.contact",e.ResourceContact="metadata.resource.contact",e.MetadataContact="metadata.contact",e.ItemOwner="item.owner",e.None="none"}(T||(T={}));const Y=e=>Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[1]),L=[{type:"CC0-1.0",abbr:"CC0",name:"Public Domain Dedication",url:"https://creativecommons.org/publicdomain/zero/1.0"},{type:"CC-BY-4.0",abbr:"CC BY",name:"Attribution 4.0 International",url:"https://creativecommons.org/licenses/by/4.0"},{type:"CC-BY-3.0",abbr:"CC BY 3.0",name:"Attribution 3.0 Unported",url:"https://creativecommons.org/licenses/by/3.0"},{type:"CC-BY-2.5",abbr:"CC BY 2.5",name:"Attribution 2.5 Generic",url:"https://creativecommons.org/licenses/by/2.5"},{type:"CC-BY-2.0",abbr:"CC BY 2.0",name:"Attribution 2.0 Generic",url:"https://creativecommons.org/licenses/by/2.0"},{type:"CC-BY-1.0",abbr:"CC BY 1.0",name:"Attribution 1.0 Generic",url:"https://creativecommons.org/licenses/by/1.0"},{type:"CC-BY-SA-4.0",abbr:"CC BY-SA",name:"Attribution-ShareAlike 4.0 International",url:"https://creativecommons.org/licenses/by-sa/4.0"},{type:"CC-BY-SA-3.0",abbr:"CC BY-SA 3.0",name:"Attribution-ShareAlike 3.0 Unported",url:"https://creativecommons.org/licenses/by-sa/3.0"},{type:"CC-BY-SA-2.5",abbr:"CC BY-SA 2.5",name:"Attribution-ShareAlike 2.5 Generic",url:"https://creativecommons.org/licenses/by-sa/2.5"},{type:"CC-BY-SA-2.0",abbr:"CC BY-SA 2.0",name:"Attribution-ShareAlike 2.0 Generic",url:"https://creativecommons.org/licenses/by-sa/2.0"},{type:"CC-BY-SA-1.0",abbr:"CC BY-SA 1.0",name:"Attribution-ShareAlike 1.0 Generic",url:"https://creativecommons.org/licenses/by-sa/1.0"},{type:"CC-BY-ND-4.0",abbr:"CC BY-ND",name:"Attribution-NoDerivatives 4.0 International",url:"https://creativecommons.org/licenses/by-nd/4.0"},{type:"CC-BY-ND-3.0",abbr:"CC BY-ND 3.0",name:"Attribution-NoDerivs 3.0 Unported",url:"https://creativecommons.org/licenses/by-nd/3.0"},{type:"CC-BY-ND-2.5",abbr:"CC BY-ND 2.5",name:"Attribution-NoDerivs 2.5 Generic",url:"https://creativecommons.org/licenses/by-nd/2.5"},{type:"CC-BY-ND-2.0",abbr:"CC BY-ND 2.0",name:"Attribution-NoDerivs 2.0 Generic",url:"https://creativecommons.org/licenses/by-nd/2.0"},{type:"CC-BY-ND-1.0",abbr:"CC BY-ND 1.0",name:"Attribution-NoDerivs 1.0 Generic",url:"https://creativecommons.org/licenses/by-nd/1.0"},{type:"CC-BY-NC-4.0",abbr:"CC BY-NC",name:"Attribution-NonCommercial 4.0 International",url:"https://creativecommons.org/licenses/by-nc/4.0"},{type:"CC-BY-NC-3.0",abbr:"CC BY-NC 3.0",name:"Attribution-NonCommercial 3.0 Unported",url:"https://creativecommons.org/licenses/by-nc/3.0"},{type:"CC-BY-NC-2.5",abbr:"CC BY-NC 2.5",name:"Attribution-NonCommercial 2.5 Generic",url:"https://creativecommons.org/licenses/by-nc/2.5"},{type:"CC-BY-NC-2.0",abbr:"CC BY-NC 2.0",name:"Attribution-NonCommercial 2.0 Generic",url:"https://creativecommons.org/licenses/by-nc/2.0"},{type:"CC-BY-NC-1.0",abbr:"CC BY-NC 1.0",name:"Attribution-NonCommercial 1.0 Generic",url:"https://creativecommons.org/licenses/by-nc/1.0"},{type:"CC-BY-NC-SA-4.0",abbr:"CC BY-NC-SA",name:"Attribution-NonCommercial-ShareAlike 4.0 International",url:"https://creativecommons.org/licenses/by-nc-sa/4.0"},{type:"CC-BY-NC-SA-3.0",abbr:"CC BY-NC-SA 3.0",name:"Attribution-NonCommercial-ShareAlike 3.0 Unported",url:"https://creativecommons.org/licenses/by-nc-sa/3.0"},{type:"CC-BY-NC-SA-2.5",abbr:"CC BY-NC-SA 2.5",name:"Attribution-NonCommercial-ShareAlike 2.5 Generic",url:"https://creativecommons.org/licenses/by-nc-sa/2.5"},{type:"CC-BY-NC-SA-2.0",abbr:"CC BY-NC-SA 2.0",name:"Attribution-NonCommercial-ShareAlike 2.0 Generic",url:"https://creativecommons.org/licenses/by-nc-sa/2.0"},{type:"CC-BY-NC-SA-1.0",abbr:"CC BY-NC-SA 1.0",name:"Attribution-NonCommercial-ShareAlike 1.0 Generic",url:"https://creativecommons.org/licenses/by-nc-sa/1.0"},{type:"CC-BY-NC-ND-4.0",abbr:"CC BY-NC-ND",name:"Attribution-NonCommercial-NoDerivatives 4.0 International",url:"https://creativecommons.org/licenses/by-nc-nd/4.0"},{type:"CC-BY-NC-ND-3.0",abbr:"CC BY-NC-ND 3.0",name:"Attribution-NonCommercial-NoDerivs 3.0 Unported",url:"https://creativecommons.org/licenses/by-nc-nd/3.0"},{type:"CC-BY-NC-ND-2.5",abbr:"CC BY-NC-ND 2.5",name:"Attribution-NonCommercial-NoDerivs 2.5 Generic",url:"https://creativecommons.org/licenses/by-nc-nd/2.5"},{type:"CC-BY-NC-ND-2.0",abbr:"CC BY-NC-ND 2.0",name:"Attribution-NonCommercial-NoDerivs 2.0 Generic",url:"https://creativecommons.org/licenses/by-nc-nd/2.0"},{type:"CC-BY-NC-ND-1.0",abbr:"CC BY-NC-ND 1.0",name:"Attribution-NonCommercial-NoDerivs 1.0 Generic",url:"https://creativecommons.org/licenses/by-nc-nd/1.0"},{type:"PDDL-1.0",abbr:"PDDL",name:"ODC Public Domain Dedication and License",url:"https://opendatacommons.org/licenses/pddl/summary"},{type:"ODbL-1.0",abbr:"ODbL",name:"ODC Open Database License",url:"https://opendatacommons.org/licenses/odbl/summary"},{type:"ODC-BY-1.0",abbr:"ODC BY",name:"ODC Attribution License",url:"https://opendatacommons.org/licenses/by/summary"}];class G{constructor(){this.operations=[]}startOperation(e){const r=t(e);r.startedAt=(new Date).getTime(),r.state="working",this.operations.push(r)}start(t,n){const a={type:t,id:e(n,"id",r(`${t}_`)),inputs:e(n,"inputs",{}),cleanup:e(n,"cleanup","n/a"),startedAt:(new Date).getTime(),state:"working"};return this.operations.push(a),a.id}getOperation(e){return this.operations.find((t=>t.id===e))}getOperations(){return this.operations}finish(e,r){const n=this.getOperation(e);if(!n)throw new Error(`No operation with id ${e} present in stack`);n.duration=(new Date).getTime()-n.startedAt,n.state="completed",r&&(n.output=t(r))}merge(e){this.operations=[...this.operations,...e.operations]}getCompleted(){return t(this.operations.filter((e=>"completed"===e.state)))}getWorking(){return t(this.operations.filter((e=>"working"===e.state)))}toString(){return this.operations.sort(((e,t)=>e.startedAt<t.startedAt?-1:t.startedAt<e.startedAt?1:0)).map(q).join("\n")}serialize(){return{operations:t(this.getOperations())}}}function q(e){let t=`${e.startedAt} : Operation ${e.id} started with inputs ${JSON.stringify(e.inputs)} but was not completed`;return"completed"===e.state&&(t=`${e.startedAt} : Operation ${e.id} took ${e.duration} ms with inputs ${JSON.stringify(e.inputs)} and output ${e.output?JSON.stringify(e.output):"n/a"}`),t}const R=(e,t,r)=>{const{data:n,stack:a,requestOptions:o}=t;return a.finish(r,{error:e}),{data:Object.assign(Object.assign({},n),{errors:W(e,n.errors)}),stack:a,requestOptions:o}},U={groupIds:e=>{const{data:t,stack:r,requestOptions:n}=e,a=r.start("enrichGroupIds");return d(t.item.id,n).then((e=>{const{admin:o,member:i,other:s}=e,c=[...o,...i,...s].map((e=>e.id));return r.finish(a),{data:Object.assign(Object.assign({},t),{groupIds:c}),stack:r,requestOptions:n}})).catch((t=>R(t,e,a)))},metadata:e=>{const{data:t,stack:r,requestOptions:n}=e,a=r.start("enrichMetadata");return async function(e,t){try{const r=await b(e,t);return await async function(e){const{parse:t}=await import("./p-151a3c68.js").then((function(e){return e.p}));return t(e,{ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"#value"})}(r)}catch(e){return null}}(t.item.id,n).then((e=>(r.finish(a),{data:Object.assign(Object.assign({},t),{metadata:e}),stack:r,requestOptions:n})))},ownerUser:e=>{const{data:t,stack:r,requestOptions:n}=e,a=r.start("enrichOwner"),o=Object.assign({username:t.item.owner},n);return i(o).then((e=>(r.finish(a),{data:Object.assign(Object.assign({},t),{ownerUser:e}),stack:r,requestOptions:n}))).catch((t=>R(t,e,a)))},org:e=>{const{data:t,stack:r,requestOptions:i}=e,s=r.start("enrichOrg"),c=se(t.item,t.ownerUser);return(c?function(e,t){const r=a(t,"portal")||a(t,"authentication.portal")||"www.arcgis.com",i=`${o(r)}/sharing/rest`;return n(e,Object.assign(Object.assign({},t),{portal:i}))}(c,i):Promise.resolve(void 0)).then((e=>(r.finish(s),{data:Object.assign(Object.assign({},t),{org:e}),stack:r,requestOptions:i}))).catch((t=>R(t,e,s)))},data:e=>{const{data:t,stack:r,requestOptions:n}=e,a=r.start("enrichData");return m(t.item.id,n).then((e=>(r.finish(a),{data:Object.assign(Object.assign({},t),{data:e}),stack:r,requestOptions:n}))).catch((t=>R(t,e,a)))},server:e=>{const{data:t,stack:r,requestOptions:n}=e,a=r.start("enrichServer"),o=x(t.item.url);return(i=Object.assign(Object.assign({},n),{url:o}),l(p(i.url),i)).then((e=>(r.finish(a),{data:Object.assign(Object.assign({},t),{server:e}),stack:r,requestOptions:n}))).catch((t=>R(t,e,a)));var i},layers:e=>{const{data:t,stack:r,requestOptions:n}=e,a=r.start("enrichLayers"),o=t.item.url;return function(e){var t=e.url,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}(e,["url"]),n=x(t)+"/layers";return l(n,r)}(Object.assign(Object.assign({},n),{url:o})).then((e=>[...e.layers,...e.tables].filter((e=>"Group Layer"!==e.type)))).then((e=>(r.finish(a),{data:Object.assign(Object.assign({},t),{layers:e}),stack:r,requestOptions:n}))).catch((t=>R(t,e,a)))}},W=(e,t=[])=>[...t,{type:"Other",message:"string"==typeof e?e:e.message}],_=(e,t,r)=>{const n=t.reduce(((e,t)=>{const r=U[t];return r&&e.push(r),e}),[]);var a;return(a=n,e=>a.reduce(((t,r)=>t.then(r).catch((t=>{if("OperationError"===t.name)return Promise.reject(t);{const t=`IPipeableFn did not reject with an OperationError \n Operation Stack: \n ${e.stack.toString()}`,r=new h("pipeline execution error",t);return r.operationStack=e.stack.serialize(),Promise.reject(r)}}))),Promise.resolve(e)))({data:{item:e},stack:new G,requestOptions:r}).then((e=>e.data))};function H(e){let t;switch(e.toLowerCase()){case"image service":t="dataset";break;case"feature service":case"raster layer":t="map";break;case"microsoft excel":t="document";break;case"cad drawing":case"feature collection template":case"report template":t="content";break;case"hub project":t="project";break;default:t={other:"content",solution:"template"}[r=(e=>{if(!e)return;const t=e.toLocaleLowerCase();return Object.keys(N).find((e=>N[e].some((e=>e.toLocaleLowerCase()===t))))})(e)]||r}var r;return t}const V=e=>e&&e.isPortal,J=(e,t)=>!!e&&"public"===e.access&&!V(t),K=(e,t)=>!V(t)&&"public"===e.access&&"CSV"===e.type&&e.size<=5e6,z=(e,t,r)=>{let n=Z(e,t,r)||X(e,t,r);if(!n){const a=H(e),o=["app","dataset","document","map","template","project"];let i="/content";"feedback"===a?i="/feedback/surveys":Q(e,r)?i="/pages":o.indexOf(a)>-1&&(i=`/${a}s`),n=`${i}/${t}`}return n},Q=(e,t=[])=>["Hub Page","Site Page"].includes(e)||t.includes("hubPage"),Z=(e,t,r)=>{let n;return"Solution"===e?n=(null==r?void 0:r.indexOf("Deployed"))>-1?`/content/${t}/about`:`/templates/${t}/about`:"Web Mapping Application"===e&&(null==r?void 0:r.indexOf("hubSolutionTemplate"))>-1&&(n=`/templates/${t}/about`),n},X=(e,t,r)=>{if("Hub Initiative"===e&&(null==r?void 0:r.indexOf("hubInitiativeTemplate"))>-1||"Hub Initiative Template"===e)return`/initiatives/templates/${t}/about`};function ee(e){return{updateFrequency:"metadata.dataIdInfo.resMaint.maintFreq.MaintFreqCd.@_value",reviseDate:"metadata.dataIdInfo.idCitation.date.reviseDate",pubDate:"metadata.dataIdInfo.idCitation.date.pubDate",createDate:"metadata.dataIdInfo.idCitation.date.createDate",metadataUpdateFrequency:"metadata.mdMaint.maintFreq.MaintFreqCd.@_value",metadataUpdatedDate:"metadata.mdDateSt"}[e]}function te(e,t){const r=ee(t);return r&&a(e,r)}var re;!function(e){e.Year="year",e.Month="month",e.Day="day",e.Time="time"}(re||(re={}));const ne=e=>Array.isArray(e)?e:[e],ae=(e,t)=>{const r=t.url&&x(t.url);return r&&e.linkage&&e.linkage.includes(r)},oe=(e,t,r)=>{let n=e.linkage;const o=a(r,"authentication.token");if(o&&ae(e,t)){const t=new URL(e.linkage),r=new URLSearchParams(t.search);r.set("token",o),t.search=r.toString(),n=t.toString()}return n},ie=(e,t)=>{const r=a(e,t)||{},{rpIndName:n,rpOrgName:o}=Array.isArray(r)?r[0]:r;return{individualName:n,organizationName:o}},se=(e,t)=>e.orgId||(null==t?void 0:t.orgId),ce=(e,t,r,n)=>!K(e,n)&&t&&r&&r.length>1&&!fe(e.url);var ue;!function(e){e.Continual="continual",e.Daily="daily",e.Weekly="weekly",e.Fortnightly="fortnightly",e.Monthly="monthly",e.Quarterly="quarterly",e.Biannually="biannually",e.Annually="annually",e.AsNeeded="as-needed",e.Irregular="irregular",e.NotPlanned="not-planned",e.Unknown="unknown",e.Semimonthly="semimonthly"}(ue||(ue={}));const le=(e,t)=>({"001":ue.Continual,"002":ue.Daily,"003":ue.Weekly,"004":ue.Fortnightly,"005":ue.Monthly,"006":ue.Quarterly,"007":ue.Biannually,"008":ue.Annually,"009":ue.AsNeeded,"010":ue.Irregular,"011":ue.NotPlanned,"012":ue.Unknown,"013":ue.Semimonthly}[te(e,t||"updateFrequency")]),pe=(e,t)=>{const r=function(e){let t,r;if(/^\d{4}$/.test(e=`${e}`))t=new Date(+e,0,1),r=re.Year;else if(/^\d{4}-\d{1,2}$/.test(e)){const n=e.split("-");t=new Date(+n[0],+n[1]-1,1),r=re.Month}else if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(e)){const n=e.split("-");t=new Date(+n[0],+n[1]-1,+n[2]),r=re.Day}else Number.isNaN(Date.parse(e))||(t=new Date(e),r=e.includes("T")?re.Time:re.Day);return t&&r&&{date:t,precision:r}}(te(e,t));return r&&Object.assign(Object.assign({},r),{source:`metadata.${ee(t)}`})},de=(e,t)=>{const r=`${t}.editingInfo.lastEditDate`,n=a(e,r);return n&&{date:new Date(n),source:r,precision:re.Day}},me=(e,t)=>({date:new Date(e[t]),precision:re.Day,source:`item.${t}`}),be=(e,t)=>{let r;return K(e,t)&&(r=`${P(t).replace("/api/v3","")}/datasets/${e.id}_0/FeatureServer/0`),r},fe=e=>{const t=e&&e.match(/\/\d+$/);return t&&t[0].slice(1)},ye=e=>e&&"feature service"===e.toLowerCase();function ge(e={}){let t=e.type;const r=e.typeKeywords||[];return function(e,t=[]){return"Site Application"===e||"Hub Site Application"===e||"Web Mapping Application"===e&&t.includes("hubSite")}(e.type,r)&&(t="Hub Site Application"),("Site Page"===e.type||"Web Mapping Application"===e.type&&g(r,"hubPage"))&&(t="Hub Page"),"Hub Initiative"===e.type&&g(r,"hubInitiativeTemplate")&&(t="Hub Initiative Template"),"Web Mapping Application"===e.type&&g(r,"hubSolutionTemplate")&&(t="Solution"),t}const he=(e,t,r)=>{const n=fe(e.url),a=n?parseInt(n,10):r;return t&&(c(a)?ye(e.type)&&(e=>{const t=e&&1===e.length?e[0]:void 0;return t&&t.capabilities.includes("Query")?t:void 0})(t):t.find((e=>e.id===a)))},ve=e=>e.isView,Ce=(e,t)=>{const{slug:r,requestOptions:n,data:o,metadata:i,groupIds:c,ownerUser:u,org:l,errors:p,server:d,layers:m,recordCount:b,boundary:f,extent:y,searchDescription:h,statistics:v}=t||{},C=he(e,m,null==t?void 0:t.layerId),O=((e,t,r)=>K(e,r)?e.id:J(e,r)?t?`${e.id}_${t.id}`:(e=>{if("public"!==e.access)return;const t=e.id,r=(e=>fe(e.url)||ye(e.type)&&e.typeKeywords&&g(e.typeKeywords,"Singlelayer")&&"0")(e);return r?`${t}_${r}`:t})(e):void 0)(e,C,n),w=r||O||e.id,D=((e,t,r,n)=>((ce(e,t,r,n)?t.name:e.title||e.name)||"").replace(/_/g," "))(e,C,m,n),k=ce(e,C,m,n)&&C.description,A=C?C.type:ge(e),P=Object.assign({relative:z(A,w,e.typeKeywords)},n&&((e,t)=>{const r=t.authentication,n=r&&r.token;var a;return{portalHome:(a=e.id,`${S(t)}/home/item.html?id=${a}`),portalApi:j(e,t,n),portalData:((e,t,r)=>{const n=j(e,t,r),a=new RegExp(`\\/${e.id}\\?f=json`);return n&&n.replace(a,`/${e.id}/data`).replace(/\&token/,"?token")})(e,t,n),thumbnail:function(e,t,r){if(!e||!e.thumbnail)return null;let{token:n,width:a}=r||{};n||"string"!=typeof r||(n=r);const o=j(e,t,n),[i,s]=o.split("?"),c=new URLSearchParams(s);c.delete("f"),a&&c.append("w",a+"");const u=c.toString(),l=`${i}/info/${e.thumbnail}`;return u?`${l}?${u}`:l}(e,t,{token:n})}})(e,n)),N=be(e,n),I=((e,t)=>pe(t.metadata,"reviseDate")||de(t,"layer")||de(t,"server")||me(e,"modified"))(e,{metadata:i,layer:C,server:d}),$=((e,t)=>pe(t,"pubDate")||pe(t,"createDate")||me(e,"created"))(e,i),E=((e,t)=>pe(t,"metadataUpdatedDate")||me(e,"modified"))(e,i),F="update"===e.itemControl||"admin"===e.itemControl,G="admin"===e.itemControl;return Object.assign(Object.assign({item:e},e),{slug:r,data:o,metadata:i,groupIds:c,ownerUser:u,org:l,errors:p||[],server:d,layers:m,recordCount:b,statistics:v,hubId:O,identifier:w,get isProxied(){return!!N},layer:C,name:D,get canEdit(){return F},get canDelete(){return G},get title(){return D},get description(){return k||e.description},type:A,get family(){return H(A)},get url(){return N||(C?`${x(e.url)}/${C.id}`:e.url)},get categories(){return function(e){if(!e)return e;const t=["categories",""];return e.map((e=>e.split("/"))).reduce(((e,t)=>[...e,...t]),[]).filter((e=>!g(t,e.toLowerCase())))}(e.categories)},get actionLinks(){return e.properties&&e.properties.links},get hubActions(){return e.properties&&e.properties.actions},get isDownloadable(){return function(e){return-1!==M.indexOf(e.type)||e.typeKeywords&&B.some((t=>e.typeKeywords.some((e=>e===t))))}(e)},get structuredLicense(){return function(e){let t;t={type:(e=e||"")?"custom":"none",text:e};let r=!1;const n=L.filter((t=>function(e,t){return(e=e.toLowerCase()).includes(t.name.toLowerCase())||e.includes(t.url.toLowerCase())||e.includes(t.abbr.toLowerCase())}(e,t)));if(n.length&&(r=!0,t=n.pop()),!r){let r;if(function(e){try{return!!new URL(e).protocol}catch(e){return!1}}(e))r=e;else if(function(e){return new RegExp(/^<a[\s]+(href\s?=\s?["'].*?["'])+([^>]?)>((?:.(?!\<\/a\>))*.)?<\/a>$|^<a[\s]+(href\s?=\s?["'].*?["'])+([^>]?)\/>/).test(e)}(e)){const t=new RegExp(/href\s?=\s?["'](.*?)["']/);r=e.match(t)[1]}r&&(t.url=r,t.text="")}return t.text||delete t.text,t}(e.licenseInfo)},get permissions(){return{visibility:e.access,control:e.itemControl||"view"}},get extent(){return((e,t,r)=>{const n=Y(e.extent)?e.extent:void 0,o=Y(null==t?void 0:t.coordinates)?t.coordinates:void 0,i=4326===a(r,"extent.spatialReference.wkid")?[[(s=r.extent).xmin,s.ymin],[s.xmax,s.ymax]]:void 0;var s;return n||o||i})(e,y,C)},get boundary(){return"automatic"===(null==f?void 0:f.provenance)?f:(e=>{var t;const r=e.extent,n=Y(r),a=(null===(t=e.properties)||void 0===t?void 0:t.boundary)||(n?"item":void 0),o={geometry:null,provenance:a};if("item"===a&&n){const e=(e=>{const[[t,r],[n,a]]=e;return function(e,t,r,n,a=4326){return{xmin:e,ymin:t,xmax:r,ymax:n,spatialReference:{wkid:a}}}(t,r,n,a)})(r),t=(e=>{const{xmin:t,ymin:r,xmax:n,ymax:a,spatialReference:o}=e;return{x:(n-t)/2+t,y:(a-r)/2+r,spatialReference:o}})(e);o.center=[t.x,t.y],o.geometry=Object.assign(Object.assign({},(e=>{const{xmin:t,ymin:r,xmax:n,ymax:a,spatialReference:o}=e;return{rings:[[[t,a],[n,a],[n,r],[t,r],[t,a]]],spatialReference:o}})(e)),{type:"polygon"}),o.spatialReference=o.geometry.spatialReference}return o})(e)},get summary(){return h||e.snippet||e.description},urls:P,get portalHomeUrl(){return P.portalHome},get portalDataUrl(){return P.portalData},get portalApiUrl(){return P.portalApi},get thumbnailUrl(){return P.thumbnail},get createdDate(){return new Date(e.created)},createdDateSource:"item.created",get updatedDate(){return I.date},get updatedDateSource(){return I.source},get updatedDatePrecision(){return I.precision},get modified(){return I.date.getTime()},get publishedDate(){return $.date},get publishedDateSource(){return $.source},get publishedDatePrecision(){return $.precision},get metadataUpdatedDate(){return E.date},get metadataUpdatedDateSource(){return E.source},get metadataUpdatedDatePrecision(){return E.precision},get updateFrequency(){return le(i)},get metadataUpdateFrequency(){return le(i,"metadataUpdateFrequency")},get publisher(){return((e,t,r,n)=>{const o={nameSource:T.None,organizationSource:T.None},i=ie(t,"metadata.dataIdInfo.idCitation.citRespParty"),s=ie(t,"metadata.dataIdInfo.idPoC"),c=ie(t,"metadata.mdContact"),u=a(n,"fullName");i.individualName?(o.name=i.individualName,o.nameSource=T.CitationContact):s.individualName?(o.name=s.individualName,o.nameSource=T.ResourceContact):c.individualName?(o.name=c.individualName,o.nameSource=T.MetadataContact):u&&(o.name=u,o.username=n.username,o.nameSource=T.ItemOwner);const l=a(r,"name");return i.organizationName?(o.organization=i.organizationName,o.organizationSource=T.CitationContact):s.organizationName?(o.organization=s.organizationName,o.organizationSource=T.ResourceContact):c.organizationName?(o.organization=c.organizationName,o.organizationSource=T.MetadataContact):l&&(o.organization=l,o.orgId=se(e,n),o.organizationSource=T.ItemOwner),o.isExternal=o.organizationSource===T.None&&"public"!==e.access,o})(e,i,l,u)},get metrics(){return e.properties&&e.properties.metrics},get spatialReference(){var t;return(null===(t=null==C?void 0:C.extent)||void 0===t?void 0:t.spatialReference)||(e=>{const t=e.spatialReference;if(!t||"object"==typeof t)return t;const r=parseInt(t+"",10);return isNaN(r)?null:{wkid:r}})(e)},get viewDefinition(){const e=C&&ve(C)&&o&&Array.isArray(o.layers)&&o.layers.find((e=>e.id===C.id));return e?e.layerDefinition:void 0},get orgId(){return l?l.id:se(e,u)},get contentTypeIcon(){return null!==(e={appbuilderExtension:"file",appbuilderWidgetPackage:"widgets-source",application:"web",applicationConfiguration:"app-gear",arcgisProMap:"desktop",cadDrawing:"file-cad",cityEngineWebScene:"urban-model",codeAttachment:"file-code",codeSample:"file-code",colorSet:"palette",contentCategorySet:"label",csv:"file-csv",cSV:"file-csv",cSVCollection:"file-csv",dashboard:"dashboard",desktopApplication:"desktop",documentLink:"link",excaliburImageryProject:"file",explorerMap:"file",exportPackage:"file",featureCollection:"data",featureCollectionTemplate:"file",featureLayer:"data",featureService:"collection",fileGeodatabase:"data",form:"survey",geocodingService:"file",geodataService:"file",geometryService:"file",geopackage:"file",geoprocessingService:"file",globeLayer:"layers",globeService:"file",hubInitiative:"initiative",hubInitiativeTemplate:"initiative-template",hubPage:"browser",hubProject:"projects",hubSiteApplication:"web",image:"file-image",imageService:"data",insightsModel:"file",insightsPage:"graph-moving-average",insightsTheme:"palette",insightsWorkbook:"graph-moving-average",iWorkPages:"file-text",iWorkKeynote:"presentation",iWorkNumbers:"file-report",kML:"data",kMLCollection:"data",layer:"layers",layerPackage:"layers",layerTemplate:"file",locatorPackage:"file",mapArea:"file",mapDocument:"map-contents",mapImageLayer:"collection",mapPackage:"file",mapService:"collection",microsoftExcel:"file-report",microsoftPowerpoint:"presentation",microsoftWord:"file-text",mission:"file",mobileMapPackage:"map-contents",nativeApplication:"mobile",nativeApplicationInstaller:"file",nativeApplicationTemplate:"file",mobileApplication:"mobile",networkAnalysisService:"file",notebook:"code",orientedImageryCatalog:"file",orthoMappingProject:"file",orthoMappingTemplate:"file",pDF:"file-pdf",quickCaptureProject:"mobile",rasterFunctionTemplate:"file",rasterLayer:"map",realTimeAnalytic:"file",relationalDatabaseConnection:"file",reportTemplate:"file",sceneLayer:"data",sceneService:"urban-model",serviceDefinition:"file",shapefile:"data",solution:"puzzle-piece",sqliteGeodatabase:"file",statisticalDataCollection:"file",storymap:"tour",storyMap:"tour",storymapTheme:"palette",symbolSet:"file",table:"table",urbanModel:"urban-model",vectorTilePackage:"file-shape",vectorTileService:"map",visioDocument:"conditional-rules",webExperience:"apps",webMap:"map",webMappingApplication:"apps",webScene:"urban-model",wfs:"map",wFS:"map",wMS:"map",wMTS:"map",workflowManagerService:"file",workforceProject:"list-check"}[s(A)])&&void 0!==e?e:"file";var e},get additionalResources(){return((e,t)=>{const r=(e=>{const t=[];return ne(a(e,"metadata.distInfo")||[]).forEach((e=>{ne(e.distTranOps||[]).forEach((e=>{ne(e.onLineSrc||[]).forEach((e=>{t.push(e)}))}))})),t.length?t:null})(t);return r&&r.map((t=>({name:t.orName,url:oe(t,e,undefined),isDataSource:ae(t,e)})))})(e,i)},get itemControl(){return e.itemControl||"view"}})};function Oe(e){const[t,r]=e?e.split("_"):[];return{itemId:t,layerId:r}}const we=e=>{const t=[].concat.apply([],e.filter(Array.isArray));return t.length?t:void 0};class Se extends Error{constructor(e,t,r){super(e),this.status=r,this.url=t}}function De(e,t){const r=Object.assign({httpMethod:"GET"},t),n=r.fetch||fetch,a=Object.assign({"Content-Type":"application/json"},r.headers);let o,i;"GET"===r.httpMethod?o=r.params:i=JSON.stringify(r.params);const s=v({host:P(r),path:`/api/v3/${e}`.replace(/\/\//g,"/"),query:o});return n(s,{method:r.httpMethod,headers:a,body:i}).then((e=>{if(e.ok)return e.json();throw new Se(e.statusText,s,e.status)}))}const je=(e,r)=>{const n=t(e);return n.params=Object.assign(Object.assign({},n.params),{"fields[datasets]":"slug,boundary,extent,recordCount,searchDescription,statistics"}),r&&(n.params["filter[slug]"]=r),n},ke=e=>{const{itemId:t,layerId:r}=Oe(e.id),n=r&&parseInt(r,10),{slug:a,boundary:o,extent:i,recordCount:s,searchDescription:c,statistics:u}=e.attributes;return{itemId:t,layerId:n,slug:a,boundary:o,extent:i,recordCount:s,searchDescription:c,statistics:u}},Ae=async(e,t)=>{try{const r=await De(`/datasets/${e}`,je(t));return ke(r.data)}catch(e){return{errors:W(e)}}},Pe=async(e,t)=>{const r=await f(e,t);r.url=be(r,t)||r.url;const n=(null==t?void 0:t.enrichments)||(e=>{const t=["groupIds","metadata","ownerUser","org"];return(e=>{const t=ge(e);return g(["template","solution"],H(t))||g(["Web Map","Web Scene"],t)})(e)&&t.push("data"),A.test(e.url)?t.concat("server","layers"):t})(r),a=await _(r,n,t);return(async(e,t)=>{const{item:r,data:n}=e;let{layers:a}=e,o=a&&he(r,a,t&&t.layerId);if(o&&!o.type){const e=x(r.url)+"/"+o.id,n=Object.assign({url:e},t);o=await function(e){return l(p(e.url),e)}(n),a=a.map((e=>e.id===o.id?o:e))}const i=o&&ve(o)&&!n?await _(r,["data"],t):void 0;return Object.assign(Object.assign(Object.assign({},e),i),{errors:we([e.errors,null==i?void 0:i.errors]),layers:a})})(Object.assign(Object.assign({},a),{item:r}),t)};
/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/
var Ne,Ie,$e,Me,Be,Te,Ee,Fe,xe,Ye,Le,Ge,qe,Re,Ue=function(e,t,r,n){var a=(n[1]-r[1])*(t[0]-e[0])-(n[0]-r[0])*(t[1]-e[1]);if(0!==a){var o=((n[0]-r[0])*(e[1]-r[1])-(n[1]-r[1])*(e[0]-r[0]))/a,i=((t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]))/a;if(o>=0&&o<=1&&i>=0&&i<=1)return!0}return!1},We=function(e,t){for(var r=0;r<e.length-1;r++)for(var n=0;n<t.length-1;n++)if(Ue(e[r],e[r+1],t[n],t[n+1]))return!0;return!1},_e=function(e){return function(e,t){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(e[0],e[e.length-1])||e.push(e[0]),e},He=function(e){for(var t,r=0,n=0,a=e.length,o=e[n];n<a-1;n++)r+=((t=e[n+1])[0]-o[0])*(t[1]+o[1]),o=t;return r>=0},Ve=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Je=function(e,t){var r=We(e,t),n=function(e,t){for(var r=!1,n=-1,a=e.length,o=a-1;++n<a;o=n)(e[n][1]<=t[1]&&t[1]<e[o][1]||e[o][1]<=t[1]&&t[1]<e[n][1])&&t[0]<(e[o][0]-e[n][0])*(t[1]-e[n][1])/(e[o][1]-e[n][1])+e[n][0]&&(r=!r);return r}(e,t[0]);return!(r||!n)},Ke=function e(t,r){var n={};if(t.features){n.type="FeatureCollection",n.features=[];for(var a=0;a<t.features.length;a++)n.features.push(e(t.features[a],r))}if("number"==typeof t.x&&"number"==typeof t.y&&(n.type="Point",n.coordinates=[t.x,t.y],"number"==typeof t.z&&n.coordinates.push(t.z)),t.points&&(n.type="MultiPoint",n.coordinates=t.points.slice(0)),t.paths&&(1===t.paths.length?(n.type="LineString",n.coordinates=t.paths[0].slice(0)):(n.type="MultiLineString",n.coordinates=t.paths.slice(0))),t.rings&&(n=function(e){for(var t,r,n=[],a=[],o=0;o<e.length;o++){var i=_e(e[o].slice(0));if(!(i.length<4))if(He(i)){var s=[i.slice().reverse()];n.push(s)}else a.push(i.slice().reverse())}for(var c=[];a.length;){r=a.pop();var u=!1;for(t=n.length-1;t>=0;t--)if(Je(n[t][0],r)){n[t].push(r),u=!0;break}u||c.push(r)}for(;c.length;){r=c.pop();var l=!1;for(t=n.length-1;t>=0;t--)if(We(n[t][0],r)){n[t].push(r),l=!0;break}l||n.push([r.reverse()])}return 1===n.length?{type:"Polygon",coordinates:n[0]}:{type:"MultiPolygon",coordinates:n}}(t.rings.slice(0))),"number"==typeof t.xmin&&"number"==typeof t.ymin&&"number"==typeof t.xmax&&"number"==typeof t.ymax&&(n.type="Polygon",n.coordinates=[[[t.xmax,t.ymax],[t.xmin,t.ymax],[t.xmin,t.ymin],[t.xmax,t.ymin],[t.xmax,t.ymax]]]),(t.geometry||t.attributes)&&(n.type="Feature",n.geometry=t.geometry?e(t.geometry):null,n.properties=t.attributes?Ve(t.attributes):null,t.attributes))try{n.id=function(e,t){for(var r=t?[t,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<r.length;n++){var a=r[n];if(a in e&&("string"==typeof e[a]||"number"==typeof e[a]))return e[a]}throw Error("No valid id attribute found")}(t.attributes,r)}catch(e){}return JSON.stringify(n.geometry)===JSON.stringify({})&&(n.geometry=null),t.spatialReference&&t.spatialReference.wkid&&4326!==t.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(t.spatialReference)),n},ze=function(e){var t=[],r=e.slice(0),n=_e(r.shift().slice(0));if(n.length>=4){He(n)||n.reverse(),t.push(n);for(var a=0;a<r.length;a++){var o=_e(r[a].slice(0));o.length>=4&&(He(o)&&o.reverse(),t.push(o))}}return t},Qe=function e(t,r){r=r||"OBJECTID";var n,a={wkid:4326},o={};switch(t.type){case"Point":o.x=t.coordinates[0],o.y=t.coordinates[1],null!=t.coordinates[2]&&(o.z=t.coordinates[2]),o.spatialReference=a;break;case"MultiPoint":o.points=t.coordinates.slice(0),null!=t.coordinates[0][2]&&(o.hasZ=!0),o.spatialReference=a;break;case"LineString":o.paths=[t.coordinates.slice(0)],null!=t.coordinates[0][2]&&(o.hasZ=!0),o.spatialReference=a;break;case"MultiLineString":o.paths=t.coordinates.slice(0),null!=t.coordinates[0][0][2]&&(o.hasZ=!0),o.spatialReference=a;break;case"Polygon":o.rings=ze(t.coordinates.slice(0)),null!=t.coordinates[0][0][2]&&(o.hasZ=!0),o.spatialReference=a;break;case"MultiPolygon":o.rings=function(e){for(var t=[],r=0;r<e.length;r++)for(var n=ze(e[r]),a=n.length-1;a>=0;a--){var o=n[a].slice(0);t.push(o)}return t}(t.coordinates.slice(0)),null!=t.coordinates[0][0][0][2]&&(o.hasZ=!0),o.spatialReference=a;break;case"Feature":t.geometry&&(o.geometry=e(t.geometry,r)),o.attributes=t.properties?Ve(t.properties):{},t.id&&(o.attributes[r]=t.id);break;case"FeatureCollection":for(o=[],n=0;n<t.features.length;n++)o.push(e(t.features[n],r));break;case"GeometryCollection":for(o=[],n=0;n<t.geometries.length;n++)o.push(e(t.geometries[n],r))}return o};class Ze extends Se{constructor(e,t,r,n){super(e,t,r),this.error=n}}function Xe(e,t){return function(e){const{token:t,authentication:r}=e;let n=()=>Promise.resolve(t);return r&&(n=r.getToken.bind(r,r.portal)),n()}(t).then((r=>function(e,t,r){const n=new Headers(t.headers);n.append("Content-Type","application/json"),r&&n.append("Authorization",`Bearer ${r}`);const a={headers:n,method:t.httpMethod||"GET",mode:t.mode,cache:t.cache,credentials:t.credentials},o=v({host:t.hubApiUrl||"https://hub.arcgis.com",path:"/api/discussions/v1"});t.params&&("GET"===t.httpMethod?e+=`?${new URLSearchParams(t.params).toString()}`:a.body=JSON.stringify(t.params));const i=[o.replace(/\/$/,""),e.replace(/^\//,"")].join("/");return fetch(i,a).then((e=>{if(e.ok)return e.json();{const{statusText:t,status:r}=e;return e.json().then((e=>{throw new Ze(t,i,r,JSON.stringify(e.message))}))}}))}(e,t,r)))}function et(e){return e.httpMethod="GET",Xe("/posts",e)}function tt(e){return Xe("/posts",Object.assign({httpMethod:"POST"},ot(e)))}function rt(e){return Xe(`/posts/${e.postId}/reply`,Object.assign({httpMethod:"POST"},ot(e)))}function nt(e){const t=`/posts/${e.postId}`;return e.httpMethod="DELETE",Xe(t,e)}function at(e){return Xe(`/posts/${e.postId}`,Object.assign({httpMethod:"PATCH"},ot(e)))}function ot(e){const{mentionUrl:t}=e,r=
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}(e,["mentionUrl"]);return t&&(r.headers=Object.assign(Object.assign({},r.headers),{"mention-url":t})),r}function it(e){return e.httpMethod="GET",Xe("/channels",e)}function st(e){return e.httpMethod="GET",Xe(`/channels/${e.channelId}`,e)}function ct(e){return e.httpMethod="PATCH",Xe(`/channels/${e.channelId}`,e)}function ut(e){let t;try{t=new URL(e)}catch(t){throw new Error(`Invalid URI: ${e}`)}const r=t.protocol.replace(":",""),[,n]=e.split("://"),[a,o]=n.split("/");let i,s;if(o){const{itemId:e,layerId:t}=Oe(o);[i,s]=[e,t]}const c=new URLSearchParams(t.search.replace("?",""));return{source:r,type:a,id:i||null,layer:s||null,features:c.has("id")&&c.get("id").split(",")||null,attribute:c.has("attribute")&&c.get("attribute")||null}}function lt(e){var t;return!(null!==(t=e.typeKeywords)&&void 0!==t?t:[]).includes("cannotDiscuss")}function pt(e,t){return e.creator===t.username}function dt(e,t,r){return pt(e,r)||function(e,t){return e.creator===t.username||("private"===e.access?(r=["owner","admin"],(e,t)=>{const{groups:n}=t,{groups:a}=e,o=a.reduce(function(e){return function(t,r){return e.indexOf(r.userMembership.memberType)>-1&&t.push(r.id),t}}(r),[]);return n.some((e=>o.indexOf(e)>-1))})(t,e):function(e,t){return function(e){return"org_admin"===e.role&&!e.roleId}(t)&&e.orgs.indexOf(t.orgId)>-1}(e,t));var r}(t,r)}!function(e){e.ASC="ASC",e.DESC="DESC"}(Ne||(Ne={})),function(e){e.THUMBS_UP="thumbs_up",e.THUMBS_DOWN="thumbs_down",e.THINKING="thinking",e.HEART="heart",e.ONE_HUNDRED="one_hundred",e.SAD="sad",e.LAUGH="laugh",e.SURPRISED="surprised"}(Ie||(Ie={})),function(e){e.PUBLIC="public",e.ORG="org",e.PRIVATE="private"}($e||($e={})),function(e){e.PENDING="pending",e.APPROVED="approved",e.REJECTED="rejected",e.DELETED="deleted",e.HIDDEN="hidden"}(Me||(Me={})),function(e){e.GROUP="group",e.CONTENT="content"}(Be||(Be={})),function(e){e.HUB="hub",e.AGO="ago",e.URBAN="urban"}(Te||(Te={})),function(e){e.REPLIES="replies",e.REACTIONS="reactions",e.PARENT="parent",e.CHANNEL="channel"}(Ee||(Ee={})),function(e){e.SETTINGS="settings"}(Fe||(Fe={})),function(e){e.POST="post"}(xe||(xe={})),function(e){e.HAS_USER_POSTS="has_user_posts"}(Ye||(Ye={})),function(e){e.CREATED_AT="createdAt",e.CREATOR="creator",e.EDITOR="editor",e.ID="id",e.UPDATED_AT="updatedAt"}(Le||(Le={})),function(e){e.ACCESS="access",e.CREATED_AT="createdAt",e.CREATOR="creator",e.EDITOR="editor",e.ID="id",e.LAST_ACTIVITY="last_activity",e.UPDATED_AT="updatedAt"}(Ge||(Ge={})),function(e){e.BODY="body",e.CHANNEL_ID="channelId",e.CREATED_AT="createdAt",e.CREATOR="creator",e.DISCUSSION="discussion",e.EDITOR="editor",e.ID="id",e.PARENT_ID="parentId",e.STATUS="status",e.TITLE="title",e.UPDATED_AT="updatedAt"}(qe||(qe={})),function(e){e.READ="read",e.WRITE="write",e.READWRITE="readWrite",e.MODERATE="moderate",e.MANAGE="manage",e.OWNER="owner"}(Re||(Re={}));const mt=new RegExp("data-mention=('|\")(\\w)+('|\")","g"),bt=new RegExp("data-mention=","g"),ft=new RegExp("[^\\w]","g");function yt(e=""){const t=(e,t)=>e.replace(t,"");return(e.match(mt)||[]).reduce(((e,r)=>{const n=[bt,ft].reduce(t,r);return e.indexOf(n)<0?[...e,n]:e}),[])}const gt=new Map;function ht(e,t={}){const{scope:r="default",getKey:n=((...[e])=>e),ttl:a=0}=t;if(!r||"string"!=typeof r)throw new TypeError("must provide a valid cache scope");if(a&&("number"!=typeof a||a<0))throw new TypeError("ttl must be a number greater than or equal to zero");if("function"!=typeof n)throw new TypeError("getKey must be a function");return function(...o){let i;try{const[e,...t]=[...o].reverse(),[r,...n]=Object.keys(e);if("bust"!==r||n.length)throw new Error("No cache arg provided");i=t.reverse()}catch(e){i=o}const{context:s=this}=t;let c=gt.get(r);c||(c=new Map,gt.set(r,c));const u=n.apply(s,i);if(!u||"string"!=typeof u)throw new Error("getKey must return a string");let l=o.length===i.length?c.get(u):void 0;const p=Date.now();return(!l||a&&p>l.created+a)&&(l={created:p,result:e.apply(s,i)},c.set(u,l)),l.result}}const vt=ht(((e,t)=>i(Object.assign({username:e},t))),{scope:"users"});const Ct=ht((function(e,t){return O(e,t)}),{scope:"teams",ttl:5e3}),Ot=ht((function(e,t){const r=`${u(t)}/community/groups/${e}/users`,n=Object.assign({httpMethod:"GET"},t);return l(r,n)}),{scope:"teamMembers"});async function wt(e){const{id:t,currentUser:r,query:n}=e,a=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}(e,["id","currentUser","query"]),{owner:o,admins:i,users:s}=await Ot(t,a),c=[o,...i,...s].filter(((e,t,n)=>e!==r.username&&n.indexOf(e)===t));return(await Promise.all(c.map((e=>vt(e,a))))).filter((e=>e.username.includes(n)||e.fullName.includes(n)))}const St=ht(((e,t)=>n(e,t)),{scope:"orgs"});var Dt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};const jt=50,kt=512,At=475;async function Pt(e){var t,r;const{postDetails:n,includeReplyCount:a}=e,o=Dt(e,["postDetails","includeReplyCount"]);if(!n)throw new Error("Must provide postDetails object");let{postId:i,post:s}=n,c=null,u=null,l=[];if(!s)try{let e;const r=a?{relations:[Ee.REPLIES]}:{};t=await function(e){const t=`/posts/${e.postId}`;return e.httpMethod="GET",Xe(t,e)}(Object.assign({postId:i,params:r},o)),({replies:e}=t),s=Dt(t,["replies"]),i=s.id,e&&(s.replyCount=e.total)}catch(e){console.warn(`Failed to fetch post ${i}`),s=null}if(s){if(a&&void 0===s.replyCount)try{const{total:e}=await et(Object.assign({params:{start:1,num:1,parents:s.id}},o));s.replyCount=e}catch(e){console.warn(`Failed to fetch reply count for post ${s.id}`),s.replyCount=0}try{c=await vt(s.creator,o)}catch(e){c=null,console.warn(`Failed to fetch user info for ${s.creator}`)}if(null==c?void 0:c.orgId)try{u=await St(c.orgId,o)}catch(e){u=null,console.warn(`Failed to fetch user org for ${c.username}`)}const e=yt(s.body);if(e.length){try{l=await Promise.all(e.map((async e=>{let t;try{const r=await vt(e,o);let n=null;(null==r?void 0:r.orgId)&&(n=await St(r.orgId,o)),t={username:e,user:r,organization:n}}catch(e){t=null}return t})))}catch(e){l=[],console.warn(`Failed to fetch mentioned users for ${s.id}`)}l=l.filter(Boolean)}}return{post:s,postId:i||s.id,creatorDetails:{username:null!==(r=null==c?void 0:c.username)&&void 0!==r?r:null==s?void 0:s.creator,user:c,organization:u},mentionedUsers:l}}const Nt=ht(((e,t)=>function(e){var t=p(e.url)+"/"+e.id,r=E({httpMethod:"GET"},e);return l(t,r).then((function(e){return r.rawResponse?e:e.feature}))}({url:e,id:t}).then(Ke).catch((e=>(console.warn(`Failed to fetch related feature ${t}`,e.message),null)))),{scope:"relatedFeatures",getKey:(e,t)=>t.toString()});async function It(e,t){let r=[];return Number(fe(e))>=0&&(r=await Promise.all(t.map((t=>Nt(e,t)))),r.forEach(((e,r)=>{e&&(e.id=t[r])}))),r.filter(Boolean)}async function $t(e){const{channelDetails:t,user:r}=e,n=Dt(e,["channelDetails","user"]);if(!t)throw new Error("Must provide a chanelDetails object");let{channelId:a,channel:o}=t;if(!o)try{o=await st(Object.assign({channelId:a},n)),a=o.id}catch(e){console.warn(`Failed to fetch channel ${a}`)}let i,s=[];if(o){const e=Promise.all(o.groups.map((e=>Ct(e,n).catch((()=>null)))));let t,a;r&&(t=et(Object.assign({params:{start:1,num:1,sortBy:qe.CREATED_AT,sortOrder:Ne.DESC,channels:o.id,creator:r.username}},n))),[s,a]=await Promise.all([e,t]),a&&({items:[i]}=a)}return{channel:o,groups:s.filter(Boolean),channelId:a,latestUserPost:i}}const Mt=e=>({postId:e.id,post:e});async function Bt(e){const{discussion:t,start:r,sortOrder:n,sortBy:a,parents:o=[],num:i=10,geometry:s}=e,c=Dt(e,["discussion","start","sortOrder","sortBy","parents","num","geometry"]),u=await et(Object.assign({params:Object.assign(Object.assign(Object.assign({discussion:t,num:i},(null==o?void 0:o.length)&&{parents:o}),{relations:[...(null==o?void 0:o.length)?[Ee.REPLIES]:[Ee.PARENT,Ee.REPLIES],Ee.CHANNEL],sortBy:a,sortOrder:n,start:r}),s&&{geometry:s})},c)),{items:l}=u,p=Dt(u,["items"]),d=l.map((e=>{const{channel:t}=e,r=Dt(e,["channel"]),n=Boolean(r.parent),a=Mt(r);return{postDetails:n?Mt(r.parent):a,replyDetails:n?a:null,channelDetails:{channelId:t.id,channel:t}}}));return Object.assign(Object.assign({},p),{items:d})}const Tt=ht((async(e,t)=>{const r=function(e){const{itemId:t}=Oe(e);return!(!t||(r=t,"{"===r[0]&&(r=r.substring(1,r.length-1)),/^(\{){0,1}[0-9a-fA-F]{8}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{4}[-]?[0-9a-fA-F]{12}(\}){0,1}$/gi.test(r)));var r}(e)?await(async(e,t)=>{let r=await(async(e,t)=>{const r=await De("/datasets",je(t,e));return ke(r.data[0])})(e,t);const{itemId:n}=r;let{layerId:a}=r;const o=await Pe(n,t),{item:i}=o,s=k(o,["item"]),u=t&&t.layerId;return c(u)||u===a||(a=u,r=Object.assign(Object.assign({},r),await Ae(`${n}_${a}`,t))),Ce(i,Object.assign(Object.assign(Object.assign({requestOptions:t},s),r),{layerId:a,slug:e,errors:we([s.errors,r.errors])}))})((n=e,a=null==t?void 0:t.siteOrgKey,/.+::.+/.test(n)?n:`${a}::${n}`),t):await(async(e,t)=>{const{itemId:r}=Oe(e),n=await Pe(r,t),{item:a}=n,o=k(n,["item"]),i=t&&t.layerId,s=J(a,t)?await Ae(e,t):{},u=s.layerId;return Ce(a,Object.assign(Object.assign(Object.assign({requestOptions:t},o),s),{layerId:c(i)?u:i,errors:we([o.errors,s.errors])}))})(e,t);var n,a;const{layer:o,type:i}=r,s=!!o&&["Feature Layer","Table"].includes(i);return r.recordCount=s&&(c(r.recordCount)||r.viewDefinition)?await(async(e,t)=>{const{url:r,viewDefinition:n}=e,a=null==n?void 0:n.definitionExpression;try{return(await function(e){var t=y(e,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:E({where:"1=1",outFields:"*"},e.params)});return l(p(e.url)+"/query",t)}(Object.assign(Object.assign({},t),{url:r,where:a,returnCountOnly:!0}))).count}catch(e){return 1/0}})(r,t):r.recordCount,r}),{scope:"content"});async function Et(e){var t;const{bust:r,discussion:n,locationId:a}=e,o=Dt(e,["bust","discussion","locationId"]);let i={discussion:n,reference:null,displayField:null,source:null,type:null,id:null,layer:null,features:null,attribute:null};if(n){const e=ut(n),s=e.type===Be.GROUP?Ct:Tt,c=await s(e.id,o,{bust:r}),u={key:null===(t=null==c?void 0:c.layer)||void 0===t?void 0:t.displayField,isValid:qt(c)};if(a&&u.isValid)try{const{properties:e}=await Nt(c.url,a);u.value=e[c.layer.displayField]}catch(e){console.error("Failed to load location:",e.message)}i=Object.assign({discussion:n,reference:c,displayField:u},e)}return i}function Ft(e){return{type:"FeatureCollection",features:e.filter((e=>Boolean(e.geometry||Gt(e.discussion)))).map(xt).flat()}}function xt(e){const t={type:"Point",coordinates:[]},{geometry:r}=e,n=Dt(e,["geometry"]),a=[];return"GeometryCollection"===(null==r?void 0:r.type)?r.geometries.forEach(((e,r)=>{a.push({type:"Feature",geometry:e||t,properties:Object.assign(Object.assign({},n),{__index__:r})})})):a.push({type:"Feature",geometry:r||t,properties:n}),a}function Yt(e){const t=e.map((e=>e.geometry)).filter((e=>Boolean(e.coordinates.length)));return t.length?{type:"GeometryCollection",geometries:t}:null}function Lt(e,t,r){const{source:n,type:a,id:o,features:i}=ut(e);let s=`${n}://${a}/${o}_${t}`;const c=Array.from(new Set([...i||[],...r]));return c.length&&(s+=`?id=${c.join(",")}`),s}function Gt(e){if(!e)return;const{features:t}=ut(e);return t||void 0}const qt=e=>{if(!e.layer)return!1;const{layer:{displayField:t,fields:r}}=e,{name:n}=r.find((({type:e})=>"esriFieldTypeOID"===e));return Boolean(t)&&t!==n};async function Rt(e){const{user:t}=e,r=Dt(e,["user"]),n=await it(Object.assign({params:{num:4,filterBy:Ye.HAS_USER_POSTS,sortBy:Ge.LAST_ACTIVITY,sortOrder:Ne.DESC}},r)),{items:a}=n,o=Dt(n,["items"]),i=await Promise.all(a.map((async e=>$t(Object.assign({channelDetails:{channelId:e.id,channel:e},user:t},r)))));return Object.assign(Object.assign({},o),{items:i.filter((e=>Boolean(e.groups.length)&&lt(e.groups[0])))})}async function Ut(e){const{parents:t,start:r}=e,n=Dt(e,["parents","start"]),a=await et(Object.assign({params:{parents:t,num:10,start:r,sortOrder:Ne.DESC,sortBy:qe.UPDATED_AT}},n)),{items:o}=a,i=Dt(a,["items"]),s=o.map(Mt);return Object.assign(Object.assign({},i),{items:s})}function Wt({type:e}){return"Point"===e||"MultiPoint"===e?"point":"LineString"===e||"MultiLineString"===e?"line":"Polygon"===e||"MultiPolygon"===e?"polygon":void 0}async function _t(e){const{subject:t,discussable:r}=e,n=Dt(e,["subject","discussable"]);let a,o,i;"content"==(void 0===t.isInvitationOnly?"content":"group")?(a=f,o=C,i="item"):(a=O,o=w,i="group");const{typeKeywords:s}=await a(t.id,n),c=r?s.filter((e=>"cannotDiscuss"!==e)):[...s,"cannotDiscuss"],{success:u}=await o(Object.assign({[i]:{id:t.id,owner:t.owner,typeKeywords:c}},n));if(!u)throw new Error("Failed to update discussion settings");return Object.assign(Object.assign({},t),{typeKeywords:c})}export{it as A,Lt as B,Yt as C,Be as D,tt as E,st as F,at as G,kt as H,Gt as I,It as J,jt as M,qe as P,Ne as S,At as W,Ke as a,ut as b,Wt as c,Ft as d,rt as e,Et as f,Qe as g,$t as h,Pt as i,g as j,_t as k,lt as l,pt as m,dt as n,Ut as o,xt as p,ht as q,nt as r,Bt as s,yt as t,ct as u,y as v,$e as w,wt as x,Rt as y,Ct as z}