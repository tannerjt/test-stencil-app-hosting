import{r as e,h as s}from"./p-a7bcab11.js";import i from"@arcgis/core/widgets/Bookmarks.js";import t from"@arcgis/core/widgets/LayerList.js";import o from"@arcgis/core/widgets/Expand.js";import a from"@arcgis/core/widgets/BasemapToggle.js";import r from"@arcgis/core/widgets/Zoom.js";import n from"@arcgis/core/geometry/Polygon.js";import c from"@arcgis/core/layers/GraphicsLayer.js";import d from"@arcgis/core/Graphic.js";import l from"@arcgis/core/widgets/Editor.js";import*as p from"@arcgis/core/core/reactiveUtils.js";import m from"@arcgis/core/layers/FeatureLayer.js";import u from"@arcgis/core/layers/support/FeatureTemplate.js";import h from"@arcgis/core/layers/support/FeatureType.js";import{e as b,a as g}from"./p-e49ecfaf.js";import{g as y}from"./p-4e4add71.js";import{a as w}from"./p-b7cd5e4e.js";import"./p-78e655d3.js";import"./p-18586bed.js";let f=class{constructor(s){e(this,s),this.currentView="map"}handleSwitchChange(e){const{currentView:s}=this;e.target.classList.contains("sc-arcgis-hub-discussions-idea-board")&&(this.currentView="list"===s?"map":"list")}async handleMapViewReady(e){const{detail:{view:s}}=e,{data:{allowedLocations:w,allowedTopics:f}}=this;let j;s.ui.components=[],await s.when(),w&&w.length&&(j=new n(w[0].geometry),s.extent=j.extent);const v=new a({view:s,nextBasemap:"hybrid"});s.ui.add(v,"bottom-right");const I=new i({view:s,editingEnabled:!0,visibleElements:{time:!1}}),x=new o({view:s,content:I,expanded:!1});s.ui.add(x,"top-right");const B=new t({view:s,listItemCreatedFunction:e=>{const s=e.item;"group"!=s.layer.type&&(s.panel={content:"legend",open:!0})}}),C=new o({view:s,content:B,expanded:!1});s.ui.add(C,"top-right");const S=new r({view:s});s.ui.add(S,"top-right");const D=new c({title:"Allowed Discussion Boundary",graphics:[new d({geometry:j,symbol:{type:"simple-fill",color:[227,139,79,0],outline:{color:[227,139,79],width:1}}})]});s.map.add(D);const T=((e,s)=>{const i={type:"unique-value",field:"Symbol",uniqueValueInfos:e.map((e=>({value:e.symbol.style.icon,symbol:{type:"web-style",name:e.symbol.style.icon,styleName:"Esri2DPointSymbolsStyle"},label:e.label})))},t=e.map((e=>new h({id:e.symbol.style.icon,name:e.symbol.style.icon,templates:[new u({description:"",drawingTool:e.symbol.type,name:e.label,prototype:{attributes:{Symbol:e.symbol.style.icon,Body:""}}})]})));let o=[{geometry:{type:"point",x:-100,y:38},attributes:{ObjectID:1,Symbol:"hospital",Body:"A Hospital!",Creator:"Josh"}},{geometry:{type:"point",x:-101,y:39},attributes:{ObjectID:2,Symbol:"trail",Body:"A Trail!!",Creator:"Josh"}}],a=s.features.map((e=>{const s=function(e,s=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(s);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}("topic",e.properties.discussion);return{geometry:{type:"point",x:e.geometry.coordinates[0],y:e.geometry.coordinates[1]},attributes:{ObjectId:e.properties.id,Symbol:s,Body:e.properties.body,Creator:e.properties.creator}}}));return o=[...o,...a],new m({title:"Discussion",source:o,objectIdField:"ObjectID",displayField:"Symbol",typeIdField:"Symbol",types:t,renderer:i,fields:[{name:"ObjectID",alias:"ObjectID",type:"oid"},{name:"Body",alias:"Body",type:"string"},{name:"Symbol",alias:"Symbol",type:"string"},{name:"Creator",alias:"Creator",type:"string"}],popupTemplate:{content:"<strong>Author: {Creator}</strong> <br/> {Body}"}})})(f,await y(this.discussion,this.context.hubRequestOptions));s.map.add(T);const E=new l({view:s,layerInfos:[{layer:T,formTemplate:{elements:[{type:"field",fieldName:"Body",label:"Add Comment"}]}}],allowedWorkflows:"create",visibleElements:{snappingControls:!1},supportingWidgetDefaults:{featureTemplates:{visibleElements:{filter:!1}}}});s.ui.add(E,"top-left"),p.on((()=>T),"edits",(async e=>{if(e.addedFeatures.length){const[s]=e.addedFeatures,i=await T.queryFeatures({objectIds:[s.objectId],returnGeometry:!0});((e,s,i,t)=>{const o=`hub://discussion/${this.itemId}?topic=${i.attributes.Symbol}`,a=i.attributes.Body||" ",r=g(i.geometry);b(Object.assign({postId:t.postId,params:{access:"private",discussion:o,channelId:t.allowedChannels[0],body:a,geometry:r}},s.hubRequestOptions)).catch((e=>{console.error("Failed to create reply:",e.message)}))})(0,this.context,i.features[0],this.data),E.cancelWorkflow()}}))}componentDidLoad(){this.getItemData()}async getItemData(){const{context:e,itemId:s}=this;if(!e||!s)return;const{context:{session:i}}=this,t={authentication:i},o=await w(s,t);this.data=o}get discussion(){const{itemId:e}=this;return e&&`hub://discussion/${e}`}renderListView(){const{discussion:e,data:{postId:i,allowedChannels:t},context:o}=this;return s("arcgis-hub-discussions",{channelId:t[0],context:o,discussion:e,hasMap:!1,isHub:!1,postId:i})}renderMapView(){const{data:{map:e}}=this;return s("arcgis-hub-map",{mapId:e})}renderHeader(){const{title:e,body:i}=this.data;return s("div",{id:"header"},s("h1",null,e),s("h2",null,i))}render(){const{currentView:e,data:i}=this;if(i)return s("div",{class:"arcgis-hub-discussions-idea-board"},this.renderHeader(),s("calcite-label",{layout:"inline"},s("span",{class:"list"===e&&"active"},"List View"),s("calcite-switch",{checked:"map"===e}),s("span",{class:"map"===e&&"active"},"Map View")),s("div",null,"list"===e?this.renderListView():this.renderMapView()))}};f.style=".arcgis-hub-discussions-idea-board.sc-arcgis-hub-discussions-idea-board{padding:1.5rem}.active.sc-arcgis-hub-discussions-idea-board{font-weight:bold}arcgis-hub-discussions.sc-arcgis-hub-discussions-idea-board{height:60vh;margin-top:40px}arcgis-hub-map.sc-arcgis-hub-discussions-idea-board{width:100%;height:60vh}calcite-label.sc-arcgis-hub-discussions-idea-board{float:right}.esri-item-list__list-item.sc-arcgis-hub-discussions-idea-board{display:none !important}#header.sc-arcgis-hub-discussions-idea-board{margin-bottom:-25px}#header.sc-arcgis-hub-discussions-idea-board>h1.sc-arcgis-hub-discussions-idea-board{font-size:22px;margin:0;padding:0}#header.sc-arcgis-hub-discussions-idea-board>h2.sc-arcgis-hub-discussions-idea-board{font-size:18px;margin:0;padding:0}";export{f as arcgis_hub_discussions_idea_board}