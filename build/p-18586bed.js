function e(e){return Object.keys(e).some((t=>{let s=e[t];if(!s)return!1;switch(s&&s.toParam&&(s=s.toParam()),s.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function t(e){const t={};return Object.keys(e).forEach((s=>{var n,o;let r,i=e[s];if(i&&i.toParam&&(i=i.toParam()),i||0===i||"boolean"==typeof i||"string"==typeof i){switch(i.constructor.name){case"Array":const e=null===(o=null===(n=i[0])||void 0===n?void 0:n.constructor)||void 0===o?void 0:o.name;r="Array"===e?i:"Object"===e?JSON.stringify(i):i.join(",");break;case"Object":r=JSON.stringify(i);break;case"Date":r=i.valueOf();break;case"Function":r=null;break;case"Boolean":r=i+"";break;default:r=i}(r||0===r||"string"==typeof r||Array.isArray(r))&&(t[s]=r)}})),t}function s(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((t=>s(e,t))).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function n(e){const n=t(e);return Object.keys(n).map((e=>s(e,n[e]))).join("&")}var o={FormData:globalThis.FormData,File:globalThis.File,Blob:globalThis.Blob};class r extends Error{constructor(e,t,s,n,o){super(e);const r=new.target.prototype;Object.setPrototypeOf(this,r),e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=s,this.url=n,this.options=o}}function i(e){console&&console.warn&&console.warn.apply(console,[e])}const c="@esri/arcgis-rest-js";class a extends r{constructor(e="AUTHENTICATION_ERROR",t="AUTHENTICATION_ERROR_CODE",s,n,o){super(e,t,s,n,o),this.name="ArcGISAuthError",this.message="AUTHENTICATION_ERROR_CODE"===t?e:`${t}: ${e}`;const r=new.target.prototype;Object.setPrototypeOf(this,r)}retry(e,t=1){let s=0;const n=(o,r)=>{s+=1,e(this.url,this.options).then((e=>{const t=Object.assign(Object.assign({},this.options),{authentication:e});return l(this.url,t)})).then((e=>{o(e)})).catch((e=>{"ArcGISAuthError"===e.name&&s<t?n(o,r):r(e.name===this.name&&e.message===this.message&&s>=t?this:e)}))};return new Promise(((e,t)=>{n(e,t)}))}}function l(s,c){const l=globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}},u=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},l),c),{params:Object.assign(Object.assign({},l.params),c.params),headers:Object.assign(Object.assign({},l.headers),c.headers)}),{httpMethod:h,rawResponse:f}=u,O=Object.assign({f:"json"},u.params);let d=null;const b={method:h,signal:u.signal,credentials:u.credentials||"same-origin"};let g;if(u.headers&&u.headers["X-Esri-Auth-Client-Id"]&&s.indexOf("/oauth2/platformSelf")>-1&&(b.credentials="include"),"string"==typeof u.authentication){const e=u.authentication;g={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(e)},u.authentication.startsWith("AAPK")||u.suppressWarnings||globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING||(i("Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information."),globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=!0)}else g=u.authentication;const w=s;return(g?g.getToken(s).catch((e=>(e.url=s,e.options=u,d=e,Promise.resolve("")))):Promise.resolve("")).then((r=>{r.length&&(O.token=r),g&&g.getDomainCredentials&&(b.credentials=g.getDomainCredentials(s));const i={};if("GET"===b.method){O.token&&u.hideToken&&"undefined"==typeof window&&(i["X-Esri-Authorization"]=`Bearer ${O.token}`,delete O.token);const e=""===n(O)?s:s+"?"+n(O);u.maxUrlLength&&e.length>u.maxUrlLength||O.token&&u.hideToken?(b.method="POST",r.length&&u.hideToken&&(O.token=r,delete i["X-Esri-Authorization"])):s=e}const c=new RegExp("/items/.+/updateResources").test(s);return"POST"===b.method&&(b.body=function(s,r){const i=e(s)||r,c=t(s);if(i){const e=new o.FormData;return Object.keys(c).forEach((t=>{"undefined"!=typeof Blob&&c[t]instanceof Blob?e.append(t,c[t],c.fileName||c[t].name||t):e.append(t,c[t])})),e}return n(s)}(O,c)),b.headers=Object.assign(Object.assign({},i),u.headers),("undefined"==typeof window||window&&void 0===window.document)&&!b.headers.referer&&(b.headers.referer="@esri/arcgis-rest-js"),e(O)||c||(b.headers["Content-Type"]="application/x-www-form-urlencoded"),globalThis.fetch?globalThis.fetch(s,b):Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.request}).then((({fetch:e})=>e(s,b)))})).then((e=>{if(!e.ok){const{status:t,statusText:n}=e;throw new r(n,`HTTP ${t}`,e,s,u)}if(f)return e;switch(O.f){case"json":case"geojson":return e.json();case"html":case"text":return e.text();default:return e.blob()}})).then((e=>{if("json"!==O.f&&"geojson"!==O.f||f)return e;{const t=function(e,t,s,n,o){if(e.code>=400){const{message:s,code:o}=e;throw new r(s,o,e,t,n)}if(e.error){const{message:s,code:i,messageCode:c}=e.error,l=c||i||"UNKNOWN_ERROR_CODE";if(498===i||499===i)throw o||new a(s,l,e,t,n);throw new r(s,l,e,t,n)}if("failed"===e.status||"failure"===e.status){let s,o="UNKNOWN_ERROR_CODE";try{s=JSON.parse(e.statusMessage).message,o=JSON.parse(e.statusMessage).code}catch(t){s=e.statusMessage||e.message}throw new r(s,o,e,t,n)}return e}(e,w,0,u,d);if(d){const e=s.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];u.authentication.federatedServers[e]={token:[],expires:new Date(Date.now()+864e5)},d=null}return t}}))}function u(e,t={params:{f:"json"}}){return l(e,t).catch((e=>e instanceof a&&t.authentication&&"string"!=typeof t.authentication&&t.authentication.canRefresh&&t.authentication.refreshCredentials?e.retry((()=>t.authentication.refreshCredentials()),1):Promise.reject(e)))}function h(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}function f(e={}){return e.portal?h(e.portal):e.authentication&&"string"!=typeof e.authentication?e.authentication.portal:"https://www.arcgis.com/sharing/rest"}export{a as A,c as N,h as c,n as e,f as g,u as r,i as w}