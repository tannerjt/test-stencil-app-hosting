import{r as t,c as e,h as i,F as s,H as a,g as r}from"./p-a7bcab11.js";import{d as l}from"./p-5cd57599.js";import{i as n}from"./p-d8201573.js";import{s as o,P as c,S as d,h,i as p}from"./p-e49ecfaf.js";import{b as u}from"./p-fd260f2d.js";import{D as m}from"./p-3bf8d293.js";import{g as f,a as v}from"./p-da9f16ff.js";import"./p-dfe5a97d.js";import"./p-78e655d3.js";import"./p-18586bed.js";import"./p-b7cd5e4e.js";let b=class{constructor(i){t(this,i),this.arcgisHubDiscussionsViewFull=e(this,"arcgisHubDiscussionsViewFull",7),this.arcgisHubDiscussionsGeometryZoomTo=e(this,"arcgisHubDiscussionsGeometryZoomTo",7),this.arcgisHubDiscussionsPreviewDidRender=e(this,"arcgisHubDiscussionsPreviewDidRender",7),this.arcgisHubDiscussionsPreviewDismiss=e(this,"arcgisHubDiscussionsPreviewDismiss",7),this.hubTelemetry=e(this,"hubTelemetry",7),this.loading=!0,u(this,"handleViewFullThread","handleZoomTo","handleDismiss")}get creatorFullName(){const{intl:t,thread:{postDetails:{creatorDetails:{user:e},post:i}}}=this;let s=t.t("anonymous");return(e||(null==i?void 0:i.creator))&&(s=(null==e?void 0:e.fullName)||t.t("privateUser")),s}async componentWillLoad(){this.intl=await n.loadIntlForComponent(this.element),this.initialize()}componentDidRender(){this.arcgisHubDiscussionsPreviewDidRender.emit(this.element.offsetHeight)}async initialize(){const{channelId:t,postId:e,replyId:i,locationId:s}=this;t&&(e||i||s)&&(this.loading=!0,this.thread=s&&!e?await this.fetchThreadByLocationId():await this.fetchThreadByIds(),this.loading=!1,this.emitHubTelemetry(l.dictionary.category.interaction.action.open.label.popUp.details.post))}async fetchThreadByLocationId(){const{locationId:t,context:e,discussion:i}=this,s=`${i}%?id=%${t}%`;let{items:[a]}=await o(Object.assign({discussion:s,parents:[],num:1,sortBy:c.UPDATED_AT,sortOrder:d.DESC,start:1},e.hubRequestOptions));return a=await this.enrichThreadDetails(a),a}async fetchThreadByIds(){const{channelId:t,postId:e,replyId:i}=this;return await this.enrichThreadDetails({channelDetails:{channelId:t},postDetails:{postId:e},replyDetails:i&&{postId:i}})}async enrichThreadDetails(t){const{context:e}=this;let{channelDetails:i,postDetails:s,replyDetails:a}=t;return[i,s,a]=await Promise.all([h(Object.assign({channelDetails:i},e.hubRequestOptions)),p(Object.assign({postDetails:s},e.hubRequestOptions)),a&&p(Object.assign({postDetails:a},e.hubRequestOptions))]),{channelDetails:i,postDetails:s,replyDetails:a}}emitHubTelemetry(t){var e;const{thread:{postDetails:{postId:i},replyDetails:s,channelDetails:{channelId:a,channel:{access:r}}}}=this;this.hubTelemetry.emit(Object.assign(Object.assign({},t),{postId:null!==(e=null==s?void 0:s.postId)&&void 0!==e?e:i,parentId:(null==s?void 0:s.postId)?i:null,channelId:a,channelAccess:r}))}handleViewFullThread(){this.emitHubTelemetry(l.dictionary.category.interaction.action.open.label.thread.details[this.locationId?"location":"post"]),this.arcgisHubDiscussionsViewFull.emit()}handleZoomTo(){this.emitHubTelemetry(l.dictionary.category.interaction.action.zoom.label.in),this.arcgisHubDiscussionsGeometryZoomTo.emit(this.thread)}handleDismiss(){this.emitHubTelemetry(l.dictionary.category.interaction.action.close.label.popUp.details.post),this.arcgisHubDiscussionsPreviewDismiss.emit()}renderAvatars(){var t;const{context:e,thread:{channelDetails:{groups:[s]},postDetails:a,replyDetails:r}}=this,l=null!=r?r:a,{portal:n,token:o}=e.session,c=!l.creatorDetails.user&&l.post?{username:l.post.creator}:l.creatorDetails.user,d=[i("calcite-avatar",{"full-name":null==c?void 0:c.fullName,key:"creator",scale:"m",thumbnail:(null==c?void 0:c.thumbnail)&&f(n,c,o),"user-id":null===(t=c)||void 0===t?void 0:t.id,username:null==c?void 0:c.username})];return s&&d.push(i("calcite-avatar",{"full-name":s.title,scale:"s",thumbnail:v(e.session.portal,s,e.session.token)})),d}renderContent(){var t;const{thread:e}=this,a=null!==(t=e.replyDetails)&&void 0!==t?t:e.postDetails;return i(s,null,i("div",{class:"avatars"},this.renderAvatars()),i("address",null,i("b",null,this.creatorFullName),i("span",null,"Â·"),i("arcgis-relative-date",{dateTime:a.post.createdAt,formatStyle:"short"})),i("arcgis-multiline-ellipsis",{innerHTML:a.post.body,lines:2}),i("calcite-action-group",{id:"text-actions",layout:"horizontal"},i("calcite-action",{onClick:this.handleViewFullThread,scale:"s",text:this.intl.t("view"),textEnabled:!0}),!1,i("calcite-action",{onClick:this.handleDismiss,scale:"s",text:this.intl.t("dismiss"),textEnabled:!0})))}renderLoading(){return i("arcgis-hub-discussions-post-skeleton",null)}render(){return i(a,{"data-element":"discussions-map-preview"},this.loading?this.renderLoading():this.renderContent())}static get assetsDirs(){return["locales"]}get element(){return r(this)}static get watchers(){return{channelId:["initialize"],postId:["initialize"],replyId:["initialize"],locationId:["initialize"]}}};(function(t,e,i,s){var a,r=arguments.length,l=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,i,s);else for(var n=t.length-1;n>=0;n--)(a=t[n])&&(l=(r<3?a(l):r>3?a(e,i,l):a(e,i))||l);r>3&&l&&Object.defineProperty(e,i,l)})([m({timeout:50})],b.prototype,"initialize",null),b.style=":host{display:block;background-color:var(--calcite-ui-foreground-1);padding:1rem;padding-bottom:0.5rem;--tw-drop-shadow:drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));filter:var(--tw-drop-shadow);}address{margin-bottom:0.125rem;display:grid;font-size:var(--calcite-font-size--1);font-style:normal;line-height:1.25rem;grid-template-columns:minmax(0, max-content) 1rem minmax(0, max-content)}address b{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-bold);color:var(--calcite-ui-text-1)}address span{display:flex;justify-content:center;color:var(--calcite-ui-text-2)}address arcgis-relative-date{color:var(--calcite-ui-text-2)}arcgis-multiline-ellipsis{font-size:var(--calcite-font-size-0);line-height:1.375}calcite-action-group{margin-left:2.75rem}.avatars{position:relative;grid-row:span 2 / span 2;float:left;margin-right:1.25rem;display:flex}.avatars calcite-avatar+calcite-avatar{position:absolute;top:1rem;left:1rem;z-index:10;border-radius:9999px;border:3px solid var(--calcite-ui-foreground-1)}@media only screen and (max-width: 640px){:host{border-radius:1.75rem}}@media only screen and (min-width: 640px){:host{border-radius:1.75rem 1.75rem 1.75rem 0}}";export{b as arcgis_hub_discussions_map_preview}