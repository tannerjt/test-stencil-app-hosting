import{r as t,c as e,h as s,H as i,g as a}from"./p-a7bcab11.js";import{D as o}from"./p-3bf8d293.js";import{b as n}from"./p-fd260f2d.js";import{d as h}from"./p-5cd57599.js";import{i as c}from"./p-d8201573.js";import{watch as l}from"@arcgis/core/core/watchUtils.js";import r from"@arcgis/core/widgets/Search/SearchViewModel.js";import{l as d}from"./p-c57d2d2f.js";import"./p-dfe5a97d.js";import"@arcgis/core/kernel.js";let g=class{constructor(s){t(this,s),this.arcgisHubWidgetPanelToggled=e(this,"arcgisHubWidgetPanelToggled",7),this.hubTelemetry=e(this,"hubTelemetry",7),this.scale="m",this.suggestions=[],this.width="25rem",n(this,"handleSetInputRef","handleSetDropdownRef","searchIfEnter","toggleActive","setInputWidth")}async componentWillLoad(){const{el:t}=this,e=t&&t.closest("arcgis-hub-map-widget-container");this.viewPosition=null==e?void 0:e.viewPosition,this.intl=await c.loadIntlForComponent(t),await this.connectViewModel()}connectedCallback(){this.connectWatch()}disconnectedCallback(){this.removeWatch()}componentDidLoad(){this.setInputScale(),d()}componentDidRender(){const{active:t,inputEl:e}=this;t&&e&&(e.setFocus(),e.scale=this.inputScale,this.setInputWidth())}handleViewChange(t,e){t&&t!==e&&(this.removeWatch(),this.connectViewModel().then((()=>{this.connectWatch()})))}handleSuggestionsChange(){const{dropdownEl:t,suggestions:e}=this;t.active=Boolean(e.length)}handleActiveChange(t){const{hubTelemetry:e}=this;e.emit(t?h.dictionary.category.interaction.action.open.label.search:h.dictionary.category.interaction.action.close.label.search)}handlePanelToggled(t){const{target:e,detail:s}=t,{el:i}=this;e===i||s||(this.active=!1)}onCalciteDropdownSelect(){const{dropdownEl:t}=this;this.selectedKey=t.selectedItems[0].dataset.value,this.value=this.selected.text,this.search()}onCalciteInputChange(t){this.value=t.target.value}onCalciteInputInput(t){const{detail:{value:e}}=t;this.value=e,e&&this.getSuggestions()}handleSetDropdownRef(t){t&&(this.dropdownEl=t)}handleSetInputRef(t){t&&(this.inputEl=t)}async getSuggestions(){const{value:t,searchComplete:e,hubTelemetry:s,searchViewModel:i}=this;s.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action.search.label.query),{search:t}));const{results:[a]}=await i.suggest(t);e?this.searchComplete=!1:this.suggestions=(null==a?void 0:a.results)||[]}async search(){const{value:t,hubTelemetry:e,searchViewModel:s}=this;this.loading=!0;const i=this.selected||t,a=await s.search(i);e.emit(Object.assign(Object.assign({},h.dictionary.category.interaction.action.zoom.label.to),{details:null==a?void 0:a.searchTerm})),this.loading=!1,this.selectedKey=null,this.suggestions=[],this.searchComplete=!0}searchIfEnter(t){const{key:e}=t;"Enter"===e&&this.search()}toggleActive(){const{active:t,arcgisHubWidgetPanelToggled:e}=this;this.active=!t,e.emit(t)}connectWatch(){const{view:t}=this;t&&(this.handle=l(t,"size",this.setInputWidth))}removeWatch(){const{handle:t}=this;t&&t.remove(),this.handle=void 0}async connectViewModel(){const{view:t,searchViewModel:e}=this;t&&!e&&(await t.when(),this.searchViewModel=new r({autoSelect:!0,suggestionsEnabled:!0,maxResults:1,maxSuggestions:5,minSuggestCharacters:3,view:t}))}setInputScale(){const{scale:t}=this;this.inputScale="s"===t?"m":"l"}setInputWidth(){const{inputEl:t,view:{size:e}}=this;if(!t)return;const[s]=e,{offsetWidth:i}=t;this.width=i/s>.7?.7*s+"px":"25rem"}get positionClass(){const{viewPosition:t}=this;if(t)return`hub-widget-search ${t.split("-").join(" ")}`}get selected(){const{suggestions:t,selectedKey:e}=this;return t.filter((({key:t})=>t===e)).pop()}get styles(){const{width:t}=this;return{"--width":t}}render(){const{value:t,loading:e,scale:a,active:o,styles:n}=this,h=this.intl.t("textOpen"),c=this.intl.t("textClose"),l=this.intl.t("placeholder");return s(i,{"data-element":"map-widget-search",style:n},this.active&&s("section",{class:this.positionClass},s("calcite-dropdown",{ref:this.handleSetDropdownRef,scale:a},s("calcite-input",{clearable:!0,icon:"search",loading:e,onKeyPress:this.searchIfEnter,placeholder:l,ref:this.handleSetInputRef,scale:this.inputScale,slot:"dropdown-trigger",value:t}),s("calcite-dropdown-group",{selectionMode:"single"},this.suggestions.map((t=>s("calcite-dropdown-item",{"data-value":t.key,key:t.key},t.text)))))),s("arcgis-hub-map-widget-generic",{active:o,icon:"search",onClick:this.toggleActive,scale:a,text:o?c:h}))}static get assetsDirs(){return["locales"]}get el(){return a(this)}static get watchers(){return{view:["handleViewChange"],suggestions:["handleSuggestionsChange"],active:["handleActiveChange"]}}};(function(t,e,s,i){var a,o=arguments.length,n=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,s,i);else for(var h=t.length-1;h>=0;h--)(a=t[h])&&(n=(o<3?a(n):o>3?a(e,s,n):a(e,s))||n);o>3&&n&&Object.defineProperty(e,s,n)})([o({timeout:300})],g.prototype,"getSuggestions",null),g.style=":host{display:block}calcite-dropdown{position:absolute}calcite-input{width:var(--width)}calcite-dropdown-group{width:var(--width)}.hub-widget-search.top{position:absolute;width:var(--width)}.hub-widget-search.right{right:100%;margin-right:1rem}.hub-widget-search.left{left:100%;margin-left:1rem}";export{g as arcgis_hub_map_widget_search}